# 更新日志

所有重要的项目更改都会记录在此文件中。

本项目遵循[语义化版本控制](https://semver.org/lang/zh-CN/)。

## [0.1.14] - 2024-12-20

### 🚀 重大功能更新
- **自动依赖安装系统**: 全新的自动依赖管理系统，彻底解决用户手动安装依赖的问题
  - 插件激活时自动检查并安装所有必要依赖
  - 智能检测包管理器：pnpm > yarn > npm 优先级自动选择
  - 自动安装 Node.js 依赖：axios, fs-extra, docx, markdown-it, cheerio 等关键包
  - 完全基于 Node.js 实现，无需 Python 环境

### ✨ 用户体验大幅提升
- **一键安装体验**: 用户只需安装插件，无需任何手动操作
  - 显示友好的进度条："初始化 Markdown to Word 插件"
  - 成功安装显示："🎉 Markdown to Word 插件依赖安装完成！"
  - 安装失败提供详细错误信息和解决方案
- **智能状态管理**: 避免重复安装，提升启动速度
  - 记录安装状态到 VS Code 全局状态
  - 30天定期检查依赖完整性（可配置）
  - 检测关键文件变化自动触发重新安装

### 🛠️ 新增命令功能
- **手动依赖管理命令**:
  - `手动安装依赖`: 当自动安装失败时的备选方案
  - `检查依赖状态`: 详细检查 Node.js 和 Python 依赖状态
  - 命令可通过 Ctrl/Cmd+Shift+P 快速访问

### 🔧 技术架构改进
- **AutoDependencyInstaller 核心类**: 完整的依赖管理解决方案
  - 并行执行 Node.js 和 Python 依赖检查，提升安装速度
  - 智能包管理器检测：检查锁文件并验证可用性
  - 跨平台 Python 环境检测：python3 > python > py
  - 健壮的错误处理和重试机制
- **专用日志系统**: 
  - 独立的输出通道："Markdown to Word - 依赖安装"
  - 详细记录所有安装过程和错误信息
  - 便于问题诊断和用户支持

### 🎯 解决的核心问题
- **同事无法使用图表功能**: 解决了因缺少依赖导致的 mermaid 图表转换失败
- **包管理器差异问题**: 自动适配 pnpm 严格依赖解析 vs npm 宽松解析
- **手动安装复杂性**: 从需要执行多个命令到完全自动化
- **网络依赖问题**: 提供离线诊断和详细的网络连接检查

### 📦 依赖管理优化
- **Node.js 依赖完善**: 
  - 修复了 `nodejs/package.json` 缺失 dependencies 部分的问题
  - 添加了所有必需的依赖包声明
  - 确保 pnpm 严格模式下的依赖可访问性
- **Python 环境兼容**: 
  - 支持多种 Python 命令变体
  - 智能检测虚拟环境
  - 优先使用 requirements.txt 进行批量安装

### 🚀 性能和稳定性
- **异步并行处理**: Node.js 和 Python 依赖同时检查安装
- **智能缓存机制**: 避免重复检查已安装的依赖
- **容错设计**: 安装失败不影响插件基本功能
- **超时控制**: 5分钟安装超时，避免长时间等待

### 📋 开发者友好
- **详细调试信息**: 完整的安装过程日志
- **错误分类处理**: 针对不同错误类型提供具体解决方案
- **配置预留**: 为未来版本预留自定义配置选项
- **文档完善**: 新增 `AUTO_DEPENDENCY_INSTALLATION.md` 详细说明文档

### 🔄 向后兼容性
- **完全向后兼容**: 现有用户无需任何配置更改
- **渐进式增强**: 自动安装失败时回退到手动安装模式
- **配置保持**: 所有现有配置和设置保持不变

## [0.1.10] - 2024-12-19

### 🔧 重大修复
- **图表输出格式修复**: 修复了图表默认输出为SVG而非PNG的问题
- **图片质量优化**: 为PNG格式图表设置了300 DPI高质量输出
- **尺寸比例保持**: 确保图表按1:1比例正确保存，避免失真
- **扩展激活问题修复**: 解决了VSCode扩展无法正常激活和命令找不到的关键问题
  - 修复了 `chart_cache` 目录创建失败导致的扩展激活失败
  - 将图表缓存目录从相对路径 `./chart_cache` 改为基于系统临时目录的绝对路径
  - 增强了目录创建的错误处理和日志输出，提升调试体验
  - 解决了在VSCode扩展环境中当前工作目录不确定的问题

### ✨ 功能增强
- **智能图表选项**: 根据不同图表类型(Mermaid、PlantUML、GraphViz等)自动应用最佳渲染参数
- **高质量渲染**: PNG格式图表现在支持高DPI输出，确保在Word文档中清晰显示
- **背景优化**: 为图表设置白色背景，提升在Word文档中的显示效果

### 🛠️ 技术改进
- **API调用优化**: 改进Kroki API调用方式，使用JSON格式传递图表选项
- **参数化配置**: 支持为不同图表类型设置专门的渲染参数
- **调试信息增强**: 添加详细的图表选项日志输出，便于问题排查
- **错误处理机制**: 实现了更robust的错误处理和恢复机制
- **跨平台兼容性**: 确保扩展在macOS、Windows、Linux上的一致性表现
- **性能优化**: 优化了临时文件和缓存目录的管理策略

### 📦 依赖优化
- **Sharp库依赖完善**: 正确安装和配置了图像处理库
  - 使用 `pnpm add sharp --save` 正确安装了sharp依赖
  - 保持了pnpm配置中 `ignoredBuiltDependencies` 的兼容性
  - 消除了图表处理功能中的依赖警告

### 🚀 稳定性提升
- **路径处理优化**: 全面改进了文件和目录路径的处理逻辑
  - 使用 `path.join(os.tmpdir(), 'markdown-to-word-charts')` 确保跨平台兼容性
  - 添加了详细的错误日志，便于问题诊断和调试
  - 提升了扩展在不同操作系统和环境下的稳定性

### 📋 测试资源
- **流程图测试文档**: 新增了comprehensive的流程图测试文档
  - 包含8种不同类型的Mermaid流程图示例
  - 涵盖基础流程图、复杂业务流程、系统架构图、决策树等
  - 支持状态转换图和带样式的流程图
  - 为图表转换功能提供全面的测试用例

### 📝 配置更新
- **默认格式调整**: 将图表默认输出格式从SVG改为PNG，避免Word转换时的兼容性问题
- **质量设置**: 为PNG输出设置合理的尺寸和DPI参数

## [0.1.9] - 2025-06-12

### 修复问题 🐛
- **表格标题行修复**: 修复了HTML表格转换为Excel时，表格标题行 (thead) 未能正确识别和加粗显示的问题。
  - 增强了 `htmlToExcelConverter.js` 中对 `<thead>` 元素的检测逻辑。
  - 确保了表格标题行的单元格在Excel中应用了正确的加粗样式。
  - 通过了 `verify_excel_output.js` 脚本的验证，确认标题行在生成的Excel文件中正确显示。

## [0.1.8] - 2025-06-11

### 新增功能 ✨
- **Excel转换间隔行优化**: 新增智能间隔行高度控制功能
  
  - 提升Excel文档的可读性和视觉层次
  - 支持自定义间隔行高度设置

- **HTML到Excel转换增强**: 改进了HTML内容到Excel的转换质量
  - 优化了行高计算逻辑
  - 改进了内容行的间距处理
  - 增强了表格和文本内容的布局效果

### 改进功能 🚀
- **转换性能优化**: 提升了大文档的转换速度
  - 优化了间隔行的添加算法
  - 改进了Excel文件的生成效率
  - 减少了内存占用

### 修复问题 🐛
- **间隔行处理**: 修复了间隔行高度设置不生效的问题

  - 修复了空白行识别逻辑
  - 改进了行高重置机制

### 技术改进 🔧
- **代码结构优化**: 重构了Excel转换相关代码
  - 分离了间隔行处理逻辑
  - 改进了代码可维护性
  - 增强了调试信息输出

## [0.1.6] - 2025-05-29

### 新增功能 ✨
- **智能TOC标记支持**: 支持 `[TOC]` 标记，可以在Markdown文档中的任意位置插入目录
  - 支持大小写不敏感：`[TOC]`、`[toc]`、`[Toc]` 等
  - 支持前导空格和制表符：`  [TOC]`、`\t[toc]`
  - 目录会在标记位置精确插入，而不是固定在文档开头

- **专业三页文档结构**: 符合专业文档标准的页面布局
  - 第一页：封面页（基于文档内容自动生成）
  - 第二页：目录页（独占页面，完整目录列表）
  - 第三页开始：正文内容

- **智能封面页生成**: 基于文档实际内容生成封面页
  - 自动提取文档第一个标题作为封面标题
  - 提取文档开头描述性内容作为简介
  - 不会添加用户未明确提供的信息（版本号、作者等）
  - 保持简洁、专业的外观

### 改进功能 🚀
- **目录分页优化**: 目录现在独占页面，前后都有分页符
  - 确保目录在第二页独立显示
  - 正文从第三页开始，避免内容混乱

- **TOC标记处理增强**: 改进了Markdown转HTML的TOC标记处理
  - 更宽松的正则表达式匹配
  - 支持更多格式变体
  - 更好的边界情况处理

- **配置简化**: 移除了封面页的预设配置项
  - 不再需要配置版本号、作者等信息
  - 封面内容完全基于文档实际内容
  - 减少了用户配置的复杂性

### 修复问题 🐛
- **段落线配置显示**: 修复了配置界面中段落线选项不显示的问题
  - 添加了缺失的CSS样式定义
  - 修复了HTML结构不一致的问题
  - 完善了VS Code配置更新的错误处理

- **VS Code配置注册**: 解决了"没有注册配置"的错误提示
  - 改进了配置更新机制
  - 添加了分层配置更新策略
  - 增强了错误容错能力

### 技术改进 🔧
- **代码模块化**: 所有功能都按模块化原则组织
  - 封面页生成独立为专门方法
  - TOC处理逻辑分离
  - 更好的代码可维护性

- **调试信息增强**: 添加了详细的调试日志输出
  - TOC标记检测日志
  - 封面页生成过程日志
  - 文档结构组织日志

- **配置文档完善**: 更新了配置文件和README文档
  - 清晰的功能说明
  - 实用的使用示例
  - 完整的配置选项说明


---

## 更新说明

### 如何更新
1. 在VS Code中打开扩展面板
2. 搜索"Markdown to Word Converter"
3. 点击"更新"按钮

### 兼容性
- VS Code版本要求：1.60.0 或更高
- Node.js版本要求：14.0.0 或更高
- 支持平台：Windows、macOS、Linux

### 反馈和支持
- 如果遇到问题，请查看 [故障排除指南](https://github.com/YaYII/md_To_Html_To_World/blob/main/vscode-extension/README_FILE_HANDLING.md)
- 功能建议和问题反馈：请通过抖音、小红书联系作者
- 项目地址：[https://github.com/YaYII/md_To_Html_To_World/blob/main/vscode-extension/]