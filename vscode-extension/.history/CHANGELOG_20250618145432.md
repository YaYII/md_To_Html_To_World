# 更新日志

所有重要的项目更改都会记录在此文件中。

本项目遵循[语义化版本控制](https://semver.org/lang/zh-CN/)。

## [0.1.11] - 2025-06-18

### 🚀 项目架构重大优化

#### ✨ 完全基于 Node.js 的转换系统
- **纯 Node.js 架构**: 移除了所有 Python 依赖，实现完全基于 Node.js 的转换系统
- **多格式支持**: 支持 Markdown 转换为 Word、HTML、Excel 三种格式
- **智能图表处理**: 支持 Mermaid、PlantUML、GraphViz 等图表的高质量转换
- **自动依赖管理**: 插件激活时自动检查并安装所有必要依赖

#### 🎯 用户体验优化
- **一键安装体验**: 用户只需安装插件，无需任何手动操作
- **智能包管理器**: 自动选择最佳包管理器（pnpm > yarn > npm）
- **进度提示**: 显示友好的安装进度和状态信息
- **错误容错**: 安装失败提供详细解决方案

#### 🔧 环境兼容性增强
- **跨平台支持**: 完全兼容 Windows、macOS、Linux 系统
- **Node.js 环境检测**: 自动检查 Node.js 环境，提供安装指导
- **包管理器检测**: 支持检测便携版 Node.js 中的 npm/pnpm/yarn
- **VS Code 内置支持**: 优先使用编辑器自带的 Node.js 环境

### 🎨 核心功能特性

#### 📄 Word 文档转换
- **专业文档结构**: 支持封面页、目录页、正文的三页标准结构
- **智能目录生成**: 支持 `[TOC]` 标记，可在任意位置插入目录
- **图表高质量输出**: PNG 格式图表支持 300 DPI 高质量输出
- **表格样式优化**: 完善的表格边框、对齐、样式处理

#### 📊 Excel 文档转换
- **表格标题识别**: 正确识别和处理 HTML 表格的标题行
- **间隔行优化**: 智能间隔行高度控制，提升可读性
- **格式保持**: 保持原始文档的格式和结构

#### 🌐 HTML 输出
- **完整样式支持**: 保持 Markdown 的所有格式和样式
- **图表嵌入**: 支持图表的 SVG/PNG 格式嵌入
- **响应式设计**: 生成的 HTML 支持多设备显示

### 🚨 重要修复与优化

#### 代码架构优化
- **Python 代码清理**: 完全移除所有 Python 脚本和依赖，确保项目纯净性
- **依赖管理优化**: 统一使用 pnpm 进行包管理，提升安装稳定性
- **图表处理修复**: 修复图表缓存和输出格式问题

#### Windows 环境优化
- **Node.js 检测**: 解决 Windows 下 Node.js 未安装的检测问题
- **便携版支持**: 支持便携版 Node.js 的检测和使用
- **命令执行**: 修复 Windows 下包管理器检测失败的问题
- **Sharp 库支持**: 专门优化 Sharp 库在 Windows 下的安装

#### 图表处理优化
- **格式标准化**: 统一图表输出为 PNG 格式，确保 Word 兼容性
- **质量提升**: 设置高 DPI 输出，确保图表清晰度
- **缓存管理**: 优化图表缓存目录管理，提升性能
- **网络检查**: 修复图表服务的网络连接检测

---

## [0.1.27] - 2024-12-19

### 🚀 核心优化：pnpm 优先 + Sharp 强制安装

#### 🔧 VS Code 内置 Node.js 支持
- **新增 VS Code 内置 Node.js 检测**: 优先使用编辑器自带的 Node.js 环境
- **智能路径检测**: 支持 VS Code 和 Cursor 的内置 Node.js 路径
- **环境变量识别**: 自动检测 VSCODE_NODE_PATH 和 CURSOR_NODE_PATH

#### 📦 pnpm 优先策略
- **强制优先使用 pnpm**: 因为 pnpm 效率更高，依赖管理更好
- **自动安装 pnpm**: 如果不可用，自动通过 npm 全局安装 pnpm
- **便携版 npm 支持**: 使用便携版 npm 安装 pnpm，确保兼容性

#### 🎨 Sharp 库强制安装
- **多种安装策略**: 使用 4 种不同方法确保 Sharp 库安装成功
- **平台特定优化**: Windows 环境下使用特殊配置
- **强制重建支持**: 包括 --force 和 --install-strategy=nested 选项
- **实时验证**: 安装后立即验证 Sharp 是否真正可用

---

## [0.1.26] - 2024-12-19

### 🔧 便携版 Node.js npm 支持
- **新增便携版npm检测**: 添加了 `getPortableNpmPath()` 方法
- **修复包管理器检测**: 现在能正确识别和使用便携版Node.js中的npm/pnpm/yarn
- **改进命令执行**: 安装依赖时优先使用便携版npm，确保兼容性

---

## [0.1.25] - 2024-12-19

### 🚨 Node.js 检测增强
- **强化Node.js环境检测**: 添加了更明显的错误提示，确保用户看到Node.js缺失警告
- **改进用户引导**: 当检测不到Node.js时，会同时显示错误消息和安装选项
- **防止静默失败**: 确保在没有Node.js的情况下不会继续尝试安装依赖

---

## [0.1.24] - 2024-12-19

### 🐛 Windows便携版安装修复
- **修复Windows便携版Node.js安装失败**: 彻底解决了"s.ensureDir is not a function"错误
- **文件系统操作统一**: 在便携版安装过程中统一使用fs-extra库
- **Windows解压流程优化**: 修复了文件移动、删除等操作的兼容性问题

---

## [0.1.23] - 2024-12-19

### 🐛 关键Bug修复
- **修复图表网络检查错误**: 解决了"Invalid URL"导致的网络检查失败问题
- **图表功能URL配置修复**: 将错误的kroki_url从'cd'修正为'https://kroki.io'
- **网络连接检测优化**: 现在可以正确检测Kroki服务的可用性

---

## [0.1.22] - 2024-12-19

### 🐛 Bug修复
- **修复便携版安装错误**: 解决了"s.ensureDir is not a function"的错误
- **文件系统操作优化**: 统一使用fs-extra库进行文件操作，确保跨平台兼容性
- **自动安装流程完善**: 修复了Windows环境下便携版Node.js自动安装失败的问题

---

## [0.1.21] - 2024-12-19

### 🚀 新增功能
- **一键自动安装 Node.js**: 插件现在可以自动下载并安装便携版 Node.js，无需用户手动操作
- **便携版 Node.js 支持**: 使用便携版 Node.js 安装到插件目录，避免需要管理员权限
- **智能环境检测**: 优先使用便携版 Node.js，如果不存在则检查系统版本
- **用户友好的安装体验**: 提供直观的安装进度条和状态提示

### 🔧 改进
- **简化安装流程**: 从复杂的手动安装变为一键自动安装
- **无权限安装**: 便携版安装不需要管理员权限，适合企业环境
- **自动环境配置**: 安装完成后自动配置环境变量
- **智能重启提示**: 安装完成后提供重启编辑器选项

---

## [0.1.20] - 2024-12-20

### 🚨 重要修复 - Node.js 环境检查
- **新增 Node.js 环境检测**: 修复了 Windows 环境下 Node.js 未安装导致的问题
  - 在依赖安装前先检查 Node.js 是否可用
  - 如果 Node.js 未安装，显示友好的错误提示和安装指导
  - 提供一键跳转到 Node.js 官网下载页面
  - 避免了 "'npm.cmd' 不是内部或外部命令" 的混乱错误信息
- **统一命令检查机制**: 重构了命令可用性检查逻辑
  - 统一的 `checkCommandAvailable` 方法处理所有命令检查
  - 改进了 Windows 环境下的命令执行（自动添加 .exe 后缀）
  - 更好的错误处理和日志输出

---

## [0.1.18] - 2024-12-20

### 🔧 Windows 环境兼容性修复
- **包管理器检测增强**: 修复了 Windows 环境下包管理器检测失败的问题
  - 增强了包管理器可用性检测逻辑，支持 Windows 下的 `.cmd` 后缀
  - 改进了错误处理机制，避免检测失败时抛出未捕获异常
  - 添加了详细的诊断日志，便于问题排查
- **Sharp 库 Windows 支持**: 专门优化了 Sharp 库在 Windows 环境下的安装
  - 自动启用 `--include=optional` 参数支持可选依赖
  - 提供针对 Windows 平台的 Sharp 安装指导
  - 增加了 Sharp 库安装状态验证和友好提示

### 🚀 重大功能更新
- **自动依赖安装系统**: 全新的自动依赖管理系统，彻底解决用户手动安装依赖的问题
  - 插件激活时自动检查并安装所有必要依赖
  - 智能检测包管理器：pnpm > yarn > npm 优先级自动选择
  - 自动安装 Node.js 依赖：axios, fs-extra, docx, markdown-it, cheerio 等关键包
  - 完全基于 Node.js 实现，无需 Python 环境

### ✨ 用户体验大幅提升
- **一键安装体验**: 用户只需安装插件，无需任何手动操作
  - 显示友好的进度条："初始化 Markdown to Word 插件"
  - 成功安装显示："🎉 Markdown to Word 插件依赖安装完成！"
  - 安装失败提供详细错误信息和解决方案
- **智能状态管理**: 避免重复安装，提升启动速度
  - 记录安装状态到 VS Code 全局状态
  - 30天定期检查依赖完整性（可配置）
  - 检测关键文件变化自动触发重新安装

---

## [0.1.10] - 2024-12-19

### 🔧 重大修复
- **图表输出格式修复**: 修复了图表默认输出为SVG而非PNG的问题
- **图片质量优化**: 为PNG格式图表设置了300 DPI高质量输出
- **尺寸比例保持**: 确保图表按1:1比例正确保存，避免失真
- **扩展激活问题修复**: 解决了VSCode扩展无法正常激活和命令找不到的关键问题
  - 修复了 `chart_cache` 目录创建失败导致的扩展激活失败
  - 将图表缓存目录从相对路径改为基于系统临时目录的绝对路径
  - 增强了目录创建的错误处理和日志输出，提升调试体验

### ✨ 功能增强
- **智能图表选项**: 根据不同图表类型(Mermaid、PlantUML、GraphViz等)自动应用最佳渲染参数
- **高质量渲染**: PNG格式图表现在支持高DPI输出，确保在Word文档中清晰显示
- **背景优化**: 为图表设置白色背景，提升在Word文档中的显示效果

---

## [0.1.9] - 2024-06-12

### 修复问题 🐛
- **表格标题行修复**: 修复了HTML表格转换为Excel时，表格标题行 (thead) 未能正确识别和加粗显示的问题
  - 增强了 `htmlToExcelConverter.js` 中对 `<thead>` 元素的检测逻辑
  - 确保了表格标题行的单元格在Excel中应用了正确的加粗样式
  - 通过了验证脚本的验证，确认标题行在生成的Excel文件中正确显示

---

## [0.1.8] - 2024-06-11

### 新增功能 ✨
- **Excel转换间隔行优化**: 新增智能间隔行高度控制功能
  - 提升Excel文档的可读性和视觉层次
  - 支持自定义间隔行高度设置
- **HTML到Excel转换增强**: 改进了HTML内容到Excel的转换质量
  - 优化了行高计算逻辑
  - 改进了内容行的间距处理
  - 增强了表格和文本内容的布局效果

### 改进功能 🚀
- **转换性能优化**: 提升了大文档的转换速度
  - 优化了间隔行的添加算法
  - 改进了Excel文件的生成效率
  - 减少了内存占用

---

## [0.1.6] - 2024-05-29

### 新增功能 ✨
- **智能TOC标记支持**: 支持 `[TOC]` 标记，可以在Markdown文档中的任意位置插入目录
  - 支持大小写不敏感：`[TOC]`、`[toc]`、`[Toc]` 等
  - 支持前导空格和制表符：`  [TOC]`、`\t[toc]`
  - 目录会在标记位置精确插入，而不是固定在文档开头

- **专业三页文档结构**: 符合专业文档标准的页面布局
  - 第一页：封面页（基于文档内容自动生成）
  - 第二页：目录页（独占页面，完整目录列表）
  - 第三页开始：正文内容

- **智能封面页生成**: 基于文档实际内容生成封面页
  - 自动提取文档第一个标题作为封面标题
  - 提取文档开头描述性内容作为简介
  - 不会添加用户未明确提供的信息（版本号、作者等）
  - 保持简洁、专业的外观

### 改进功能 🚀
- **目录分页优化**: 目录现在独占页面，前后都有分页符
  - 确保目录在第二页独立显示
  - 正文从第三页开始，避免内容混乱
- **TOC标记处理增强**: 改进了Markdown转HTML的TOC标记处理
  - 更宽松的正则表达式匹配
  - 支持更多格式变体
  - 更好的边界情况处理

### 修复问题 🐛
- **段落线配置显示**: 修复了配置界面中段落线选项不显示的问题
  - 添加了缺失的CSS样式定义
  - 修复了HTML结构不一致的问题
  - 完善了VS Code配置更新的错误处理
- **VS Code配置注册**: 解决了"没有注册配置"的错误提示
  - 改进了配置更新机制
  - 添加了分层配置更新策略
  - 增强了错误容错能力

---

## 更新说明

### 🔄 如何更新
1. 在VS Code中打开扩展面板
2. 搜索"Markdown to Word Converter"
3. 点击"更新"按钮

### 📋 兼容性
- **VS Code**: 1.60.0 或更高版本
- **Node.js**: 14.0.0 或更高版本
- **支持平台**: Windows、macOS、Linux

### 📞 反馈和支持
- **文档**: 查看项目 README 获取详细使用说明
- **问题反馈**: 通过 GitHub Issues 报告问题
- **功能建议**: 欢迎通过抖音、小红书联系作者
- **项目地址**: [https://github.com/YaYII/md_To_Html_To_World/blob/main/vscode-extension/]