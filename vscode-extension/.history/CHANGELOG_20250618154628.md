# 更新日志

所有重要的项目更改都会记录在此文件中。

本项目遵循[语义化版本控制](https://semver.org/lang/zh-CN/)。

## [0.1.14] - 2025-06-18

### 🚀 插件市场兼容性重大改进

#### ✨ 插件市场发布优化
- **Publisher 配置修正**: 更新为正确的发布者名称 `YingYang`
- **仓库信息完善**: 添加完整的 GitHub 仓库链接、Issues 链接和主页
- **SEO 优化**: 添加关键词标签，提升插件市场搜索可见性
- **许可证明确**: 明确标注 MIT 许可证

#### 🎯 激活机制优化
- **双重激活事件**: 支持 `onStartupFinished` 和 `onLanguage:markdown` 两种激活方式
- **插件市场安装检测**: 新增 `checkMarketplaceInstall()` 函数自动检测首次安装
- **友好欢迎体验**: 首次从插件市场安装时显示欢迎信息和初始化提示
- **状态跟踪改进**: 增加 `marketplaceInstallCompleted` 状态追踪

#### 🔧 用户体验提升
- **首次安装引导**: 
  - 显示友好的欢迎消息
  - 提供直接的文档链接
  - 说明依赖安装过程
- **安装流程优化**: 
  - 自动检测插件市场安装环境
  - 避免重复显示欢迎信息
  - 优化后续启动速度

#### 🐛 插件市场问题修复
- **激活时机问题**: 解决插件市场安装后可能无法正确激活的问题
- **路径兼容性**: 改进扩展路径检测，适配插件市场的安装环境
- **依赖检测增强**: 更准确地检测首次安装状态

### 📦 发布准备
- **市场元数据完善**: bugs、homepage、keywords 等字段补全
- **版本控制优化**: 自动版本升级机制完善
- **打包配置验证**: 确认 .vsix 文件包含所有必要资源

---

## [0.1.11] - 2025-06-18

### 🚀 重大功能更新 - 完全基于 Node.js 的转换系统

#### ✨ 核心转换功能
- **纯 Node.js 架构**: 完全移除所有 Python 依赖，实现纯 Node.js 转换系统
- **多格式转换支持**: 
  - **Markdown → Word**: 支持专业文档结构、封面页、目录页、正文分离
  - **Markdown → HTML**: 完整样式支持、响应式设计、图表嵌入
  - **Markdown → Excel**: 表格标题识别、智能间隔行、格式保持
- **智能图表处理**: 支持 Mermaid、PlantUML、GraphViz 等图表的高质量 PNG 输出
- **批量转换**: 支持目录批量处理，提升工作效率

#### 🎯 专业文档特性
- **智能TOC标记**: 支持 `[TOC]` 标记，可在文档任意位置插入目录
  - 支持大小写不敏感：`[TOC]`、`[toc]`、`[Toc]` 等
  - 支持前导空格和制表符：`  [TOC]`、`\t[toc]`
- **三页文档结构**: 符合专业文档标准
  - 第一页：智能封面页（基于文档内容自动生成）
  - 第二页：目录页（独占页面，完整目录列表）
  - 第三页开始：正文内容
- **高质量图表**: PNG 格式图表支持 300 DPI 高质量输出
- **表格优化**: 完善的表格边框、对齐、样式处理

#### 🔧 自动化依赖管理系统
- **一键安装体验**: 用户只需安装插件，无需任何手动配置
- **智能包管理器检测**: 自动选择最佳包管理器（pnpm > yarn > npm）
- **自动 Node.js 环境检测**: 
  - 检测系统 Node.js 环境
  - 支持 VS Code 内置 Node.js 环境
  - 支持便携版 Node.js 检测和使用
- **依赖自动安装**: 自动安装所有必要的 Node.js 依赖包
  - axios, fs-extra, docx, markdown-it, cheerio 等核心包
  - sharp 库强制安装（多种策略确保成功）
- **智能状态管理**: 
  - 记录安装状态，避免重复安装
  - 30天定期检查依赖完整性
  - 检测关键文件变化自动触发重新安装

#### 🌍 跨平台兼容性优化
- **Windows 环境完全支持**:
  - 修复包管理器检测失败问题
  - 支持便携版 Node.js 安装和使用
  - 解决 Sharp 库 Windows 安装问题
  - 统一文件系统操作，确保跨平台兼容
- **macOS & Linux 支持**: 原生支持，无需额外配置
- **命令执行优化**: 
  - Windows 下自动添加 .cmd/.exe 后缀
  - 隐藏命令窗口，提升用户体验
  - 执行超时控制和错误处理

#### 🎨 用户体验优化
- **友好的安装进度**: 显示详细的安装进度和状态信息
- **错误容错处理**: 安装失败提供详细解决方案和手动指导
- **智能错误提示**: 
  - Node.js 缺失时的友好提示和安装指导
  - 网络连接问题的详细诊断
  - 依赖安装失败的分类处理
- **配置界面优化**: 
  - 修复配置界面显示问题
  - 完善 VS Code 配置更新机制
  - 支持实时配置预览

### 🛠️ 技术架构改进

#### 📦 模块化设计
- **核心转换器**: 统一的转换接口和处理流程
- **专用处理器**: 针对不同元素类型的专门处理器
- **配置管理系统**: 灵活的配置系统，支持用户自定义
- **完善的错误处理**: 分层错误处理和恢复机制

#### 🔍 图表处理系统
- **格式标准化**: 统一图表输出为 PNG 格式，确保 Word 兼容性
- **质量提升**: 设置高 DPI 输出，确保图表清晰度
- **缓存管理**: 优化图表缓存目录管理，基于系统临时目录
- **网络检查**: 自动检测 Kroki 服务可用性
- **背景优化**: 为图表设置白色背景，提升显示效果

#### 📊 Excel 转换增强
- **表格标题识别**: 正确识别和处理 HTML 表格的标题行 (thead)
- **智能间隔行**: 新增智能间隔行高度控制，提升可读性
- **格式保持**: 保持原始文档的格式和结构
- **性能优化**: 提升大文档转换速度，减少内存占用

### 🚨 重要问题修复

#### 代码架构清理
- **Python 代码完全移除**: 删除所有 Python 脚本和依赖，确保项目纯净性
- **依赖管理统一**: 统一使用 pnpm 进行包管理，提升安装稳定性
- **模块导入优化**: 修复模块导入和路径处理问题

#### 图表功能修复
- **图表输出格式**: 修复图表默认输出为 SVG 的问题，改为 PNG
- **扩展激活**: 解决 VSCode 扩展无法正常激活的关键问题
- **缓存目录**: 修复图表缓存目录创建失败问题
- **网络检查**: 修复 "Invalid URL" 导致的网络检查失败
- **URL 配置**: 修正 kroki_url 配置错误

#### Windows 环境修复
- **便携版 Node.js**: 修复便携版 Node.js 安装和检测问题
- **文件系统操作**: 解决 "s.ensureDir is not a function" 错误
- **包管理器检测**: 修复 Windows 下包管理器检测失败
- **Sharp 库安装**: 解决 Sharp 库在 Windows 环境下的安装问题

### 🎮 扩展命令

#### 转换命令
- `配置world文档` - 打开配置界面，自定义转换设置
- `生成Word文档` - 直接转换当前 Markdown 文件为 Word
- `生成HTML文档` - 转换为 HTML 格式
- `生成Excel文档` - 转换为 Excel 格式
- `批量生成Word文档` - 批量处理目录中的 Markdown 文件
- `批量生成HTML文档` - 批量转换为 HTML
- `批量生成Excel文档` - 批量转换为 Excel

#### 管理命令
- `手动安装依赖` - 手动管理和安装依赖
- `检查依赖状态` - 详细检查 Node.js 依赖状态
- `配置Excel转换` - Excel 转换专门配置

### ⚙️ 配置选项

#### 文档格式设置
- **页面设置**: 页面大小(A4/Letter/Legal)、方向(横向/纵向)
- **字体设置**: 字体家族、字号、行间距
- **边距设置**: 上下左右边距自定义

#### 内容控制
- **目录设置**: 是否包含目录、目录深度、目录标题
- **图片处理**: 图片最大宽度、是否保留图片
- **表格样式**: 表格边框、对齐方式、样式定制
- **分隔线**: 是否显示章节分隔线

#### 高级选项
- **HTML 保留**: 是否保留中间 HTML 文件
- **诊断信息**: 是否显示转换过程诊断信息
- **自定义配置**: 支持用户自定义配置扩展

### 📋 使用方法

1. **安装插件**: 在 VS Code 扩展商店搜索 "Markdown to Word" 并安装
2. **自动初始化**: 插件会自动检测和安装所需依赖（首次使用）
3. **开始转换**: 
   - 右键点击 .md 文件，选择相应的转换命令
   - 或使用 Ctrl/Cmd+Shift+P 打开命令面板搜索命令
4. **配置调整**: 使用 `配置world文档` 命令自定义转换设置
5. **批量处理**: 右键点击文件夹，选择批量转换命令

### 🔄 升级说明

- **从旧版本升级**: 自动迁移配置，无需手动操作
- **依赖更新**: 自动检查和更新依赖到最新兼容版本
- **配置保持**: 所有现有配置和设置保持不变
- **向后兼容**: 完全兼容之前版本的配置文件

---

## 版本兼容性

- **VS Code**: 1.60.0 或更高版本
- **Node.js**: 14.0.0 或更高版本
- **支持平台**: Windows、macOS、Linux

## 反馈和支持

- **文档**: 查看项目 README 获取详细使用说明
- **问题反馈**: 通过 GitHub Issues 报告问题
- **功能建议**: 欢迎通过抖音、小红书联系作者
- **项目地址**: [https://github.com/YaYII/md_To_Html_To_World/blob/main/vscode-extension/]